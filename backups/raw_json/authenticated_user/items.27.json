[{"rendered_body":"\u003cp\u003e\u003ca href=\"https://qiita.com/shiozaki/items/53c66cea655bef08b9ea\" id=\"reference-76c4091bf25aa401d0c7\"\u003ea == 1 \u0026amp;\u0026amp; a == 2 \u0026amp;\u0026amp; a == 3がtrueになるRubyスクリプト\u003c/a\u003e見て面白そうだったので書きました\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"が呼ばれたタイミングでレシーバーを変えてやり直す\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%8C%E5%91%BC%E3%81%B0%E3%82%8C%E3%81%9F%E3%82%BF%E3%82%A4%E3%83%9F%E3%83%B3%E3%82%B0%E3%81%A7%E3%83%AC%E3%82%B7%E3%83%BC%E3%83%90%E3%83%BC%E3%82%92%E5%A4%89%E3%81%88%E3%81%A6%E3%82%84%E3%82%8A%E7%9B%B4%E3%81%99\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003ccode\u003e==\u003c/code\u003eが呼ばれたタイミングでレシーバーを変えてやり直す\u003c/h2\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"rb\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"nb\"\u003erequire\u003c/span\u003e \u003cspan class=\"s1\"\u003e'continuation'\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003ea\u003c/span\u003e\n  \u003cspan class=\"nb\"\u003ecallcc\u003c/span\u003e \u003cspan class=\"k\"\u003edo\u003c/span\u003e \u003cspan class=\"o\"\u003e|\u003c/span\u003e\u003cspan class=\"n\"\u003ec\u003c/span\u003e\u003cspan class=\"o\"\u003e|\u003c/span\u003e\n    \u003cspan class=\"no\"\u003eObject\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003enew\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003etap\u003c/span\u003e \u003cspan class=\"k\"\u003edo\u003c/span\u003e \u003cspan class=\"o\"\u003e|\u003c/span\u003e\u003cspan class=\"n\"\u003eo\u003c/span\u003e\u003cspan class=\"o\"\u003e|\u003c/span\u003e\n      \u003cspan class=\"n\"\u003eo\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003edefine_singleton_method\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"ss\"\u003e:==\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"k\"\u003edo\u003c/span\u003e \u003cspan class=\"o\"\u003e|\u003c/span\u003e\u003cspan class=\"n\"\u003eother\u003c/span\u003e\u003cspan class=\"o\"\u003e|\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ec\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003ecall\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eother\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n      \u003cspan class=\"k\"\u003eend\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eend\u003c/span\u003e\n  \u003cspan class=\"k\"\u003eend\u003c/span\u003e\n\u003cspan class=\"k\"\u003eend\u003c/span\u003e\n\n\u003cspan class=\"nb\"\u003eputs\u003c/span\u003e \u003cspan class=\"n\"\u003ea\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003ea\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003ea\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"mi\"\u003e3\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e# true\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eぱっと見で動作が分かりづらいと思いますが\u003ccode\u003e==\u003c/code\u003eを確認するコードを差し込むとちゃんと\u003ccode\u003e1 == 1 \u0026amp;\u0026amp; 2 == 2 \u0026amp;\u0026amp; 3 == 3\u003c/code\u003eが実行されてることがわかります、順番的には以下のような感じです。\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003e\n\u003ccode\u003ea == 1\u003c/code\u003eの\u003ccode\u003ea\u003c/code\u003eが呼ばれる\u003c/li\u003e\n\u003cli\u003eオブジェクトがかえる\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003eobject == 1\u003c/code\u003eでオブジェクトの\u003ccode\u003e==\u003c/code\u003eメソッドが呼ばれる\u003c/li\u003e\n\u003cli\u003e引数の1を\u003ccode\u003ea\u003c/code\u003eの返り値として継続(\u003ccode\u003ea == 1\u003c/code\u003eの\u003ccode\u003e== 1\u003c/code\u003e部分)を実行する、\u003ccode\u003ea\u003c/code\u003eの返り値が1になっているので\u003ccode\u003e1 == 1\u003c/code\u003eが実行され\u003ccode\u003etrue\u003c/code\u003eがかえる\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"rb\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"nb\"\u003erequire\u003c/span\u003e \u003cspan class=\"s1\"\u003e'continuation'\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003ea\u003c/span\u003e\n  \u003cspan class=\"nb\"\u003ecallcc\u003c/span\u003e \u003cspan class=\"k\"\u003edo\u003c/span\u003e \u003cspan class=\"o\"\u003e|\u003c/span\u003e\u003cspan class=\"n\"\u003ec\u003c/span\u003e\u003cspan class=\"o\"\u003e|\u003c/span\u003e\n    \u003cspan class=\"no\"\u003eObject\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003enew\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003etap\u003c/span\u003e \u003cspan class=\"k\"\u003edo\u003c/span\u003e \u003cspan class=\"o\"\u003e|\u003c/span\u003e\u003cspan class=\"n\"\u003eo\u003c/span\u003e\u003cspan class=\"o\"\u003e|\u003c/span\u003e\n      \u003cspan class=\"n\"\u003eo\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003edefine_singleton_method\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"ss\"\u003e:==\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"k\"\u003edo\u003c/span\u003e \u003cspan class=\"o\"\u003e|\u003c/span\u003e\u003cspan class=\"n\"\u003eother\u003c/span\u003e\u003cspan class=\"o\"\u003e|\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e# 確認用\u003c/span\u003e\n        \u003cspan class=\"nb\"\u003eputs\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"object == \u003c/span\u003e\u003cspan class=\"si\"\u003e#{\u003c/span\u003e\u003cspan class=\"n\"\u003eother\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ec\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003ecall\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eother\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n      \u003cspan class=\"k\"\u003eend\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eend\u003c/span\u003e\n  \u003cspan class=\"k\"\u003eend\u003c/span\u003e\n\u003cspan class=\"k\"\u003eend\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e# 確認用\u003c/span\u003e\n\u003cspan class=\"n\"\u003eusing\u003c/span\u003e \u003cspan class=\"no\"\u003eModule\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003enew\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003erefine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"no\"\u003eInteger\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003e==\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eo\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e \u003cspan class=\"nb\"\u003eputs\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"\u003c/span\u003e\u003cspan class=\"si\"\u003e#{\u003c/span\u003e\u003cspan class=\"nb\"\u003eself\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e == \u003c/span\u003e\u003cspan class=\"si\"\u003e#{\u003c/span\u003e\u003cspan class=\"n\"\u003eo\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003esuper\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003eend\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"nb\"\u003eputs\u003c/span\u003e \u003cspan class=\"n\"\u003ea\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003ea\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003ea\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"mi\"\u003e3\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e# object == 1\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e# 1 == 1\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e# object == 2\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e# 2 == 2\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e# object == 3\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e# 3 == 3\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e# true\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eわかりやすいですね \u003cimg alt=\":smile:\" class=\"emoji\" height=\"20\" src=\"https://cdn.qiita.com/emoji/twemoji/unicode/1f604.png\" title=\":smile:\" width=\"20\"\u003e\u003cbr\u003e\nこのスクリプトなら\u003ccode\u003ea == 4 \u0026amp;\u0026amp; a == 5 \u0026amp;\u0026amp; a == 6\u003c/code\u003eと続けても\u003ccode\u003etrue\u003c/code\u003eが返ります、便利!\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"aのメソッドをrefinementsで上書き\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#a%E3%81%AE%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%82%92refinements%E3%81%A7%E4%B8%8A%E6%9B%B8%E3%81%8D\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003ccode\u003ea\u003c/code\u003eの\u003ccode\u003e==\u003c/code\u003eメソッドをRefinementsで上書き\u003c/h2\u003e\n\n\u003cp\u003e\u003ccode\u003ea.class\u003c/code\u003eのメソッドを上書きするので\u003ccode\u003ea\u003c/code\u003eにどんな値が来ても動きます。Refinementsを使って上書きするとこのスクリプトの外では\u003ccode\u003etrue\u003c/code\u003eにならないので便利ですね。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"rb\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"n\"\u003ea\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"ss\"\u003e:hi\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003eusing\u003c/span\u003e \u003cspan class=\"no\"\u003eModule\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003enew\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003erefine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eclass\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003e==\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e \u003cspan class=\"kp\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003eend\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"nb\"\u003eputs\u003c/span\u003e \u003cspan class=\"n\"\u003ea\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003ea\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003ea\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"mi\"\u003e3\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e# true\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"呼ばれるたびaが返す値をかえる\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%91%BC%E3%81%B0%E3%82%8C%E3%82%8B%E3%81%9F%E3%81%B3a%E3%81%8C%E8%BF%94%E3%81%99%E5%80%A4%E3%82%92%E3%81%8B%E3%81%88%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e呼ばれるたび\u003ccode\u003ea\u003c/code\u003eが返す値をかえる\u003c/h2\u003e\n\n\u003cp\u003e順番よく値を返していくならFiberか\u003ccode\u003eEnumerator\u003c/code\u003eを使うとべんりです!\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"rb\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"n\"\u003ef\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"no\"\u003eFiber\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003enew\u003c/span\u003e \u003cspan class=\"k\"\u003edo\u003c/span\u003e\n  \u003cspan class=\"no\"\u003eFiber\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eyield\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\n  \u003cspan class=\"no\"\u003eFiber\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eyield\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\n  \u003cspan class=\"no\"\u003eFiber\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eyield\u003c/span\u003e \u003cspan class=\"mi\"\u003e3\u003c/span\u003e\n\u003cspan class=\"k\"\u003eend\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003edefine_method\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"ss\"\u003e:a\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"k\"\u003edo\u003c/span\u003e\n  \u003cspan class=\"n\"\u003ef\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eresume\u003c/span\u003e\n\u003cspan class=\"k\"\u003eend\u003c/span\u003e\n\n\u003cspan class=\"nb\"\u003eputs\u003c/span\u003e \u003cspan class=\"n\"\u003ea\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003ea\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003ea\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"mi\"\u003e3\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e# true\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"rb\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"n\"\u003ee\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"no\"\u003eEnumerator\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003enew\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"o\"\u003e|\u003c/span\u003e\u003cspan class=\"n\"\u003ey\u003c/span\u003e\u003cspan class=\"o\"\u003e|\u003c/span\u003e \u003cspan class=\"n\"\u003ey\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u0026lt;\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u0026lt;\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u0026lt;\u003c/span\u003e \u003cspan class=\"mi\"\u003e3\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003edefine_method\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"ss\"\u003e:a\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"k\"\u003edo\u003c/span\u003e\n  \u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003enext\u003c/span\u003e\n\u003cspan class=\"k\"\u003eend\u003c/span\u003e\n\n\u003cspan class=\"nb\"\u003eputs\u003c/span\u003e \u003cspan class=\"n\"\u003ea\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003ea\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003ea\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"mi\"\u003e3\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e# true\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n","body":"[a == 1 \u0026\u0026 a == 2 \u0026\u0026 a == 3がtrueになるRubyスクリプト](https://qiita.com/shiozaki/items/53c66cea655bef08b9ea)見て面白そうだったので書きました\n\n## `==`が呼ばれたタイミングでレシーバーを変えてやり直す\n\n```rb\nrequire 'continuation'\n\ndef a\n  callcc do |c|\n    Object.new.tap do |o|\n      o.define_singleton_method(:==) do |other|\n        c.call(other)\n      end\n    end\n  end\nend\n\nputs a == 1 \u0026\u0026 a == 2 \u0026\u0026 a == 3\n# true\n```\n\nぱっと見で動作が分かりづらいと思いますが`==`を確認するコードを差し込むとちゃんと`1 == 1 \u0026\u0026 2 == 2 \u0026\u0026 3 == 3`が実行されてることがわかります、順番的には以下のような感じです。\n\n1. `a == 1`の`a`が呼ばれる\n2. オブジェクトがかえる\n3. `object == 1`でオブジェクトの`==`メソッドが呼ばれる\n4. 引数の1を`a`の返り値として継続(`a == 1`の`== 1`部分)を実行する、`a`の返り値が1になっているので`1 == 1`が実行され`true`がかえる\n\n```rb\nrequire 'continuation'\n\ndef a\n  callcc do |c|\n    Object.new.tap do |o|\n      o.define_singleton_method(:==) do |other|\n        # 確認用\n        puts \"object == #{other}\"\n        c.call(other)\n      end\n    end\n  end\nend\n\n# 確認用\nusing Module.new { refine(Integer) { def ==(o); puts \"#{self} == #{o}\"; super; end } }\n\nputs a == 1 \u0026\u0026 a == 2 \u0026\u0026 a == 3\n# object == 1\n# 1 == 1\n# object == 2\n# 2 == 2\n# object == 3\n# 3 == 3\n# true\n```\n\nわかりやすいですね :smile:\nこのスクリプトなら`a == 4 \u0026\u0026 a == 5 \u0026\u0026 a == 6`と続けても`true`が返ります、便利!\n\n## `a`の`==`メソッドをRefinementsで上書き\n\n`a.class`のメソッドを上書きするので`a`にどんな値が来ても動きます。Refinementsを使って上書きするとこのスクリプトの外では`true`にならないので便利ですね。\n\n```rb\na = :hi\n\nusing Module.new { refine(a.class) { def ==(*); true; end } }\n\nputs a == 1 \u0026\u0026 a == 2 \u0026\u0026 a == 3\n# true\n```\n\n## 呼ばれるたび`a`が返す値をかえる\n\n順番よく値を返していくならFiberか`Enumerator`を使うとべんりです!\n\n```rb\nf = Fiber.new do\n  Fiber.yield 1\n  Fiber.yield 2\n  Fiber.yield 3\nend\n\ndefine_method(:a) do\n  f.resume\nend\n\nputs a == 1 \u0026\u0026 a == 2 \u0026\u0026 a == 3\n# true\n```\n\n```rb\ne = Enumerator.new { |y| y \u003c\u003c 1 \u003c\u003c 2 \u003c\u003c 3 }\n\ndefine_method(:a) do\n  e.next\nend\n\nputs a == 1 \u0026\u0026 a == 2 \u0026\u0026 a == 3\n# true\n```\n","coediting":false,"comments_count":0,"created_at":"2018-01-24T02:20:20+09:00","group":null,"id":"cd53f2b5e408b49b61f2","likes_count":13,"private":false,"reactions_count":0,"tags":[{"name":"Ruby","versions":[]}],"title":"a == 1 \u0026\u0026 a == 2 \u0026\u0026 a == 3がtrueになるRubyスクリプト","updated_at":"2018-01-24T10:08:12+09:00","url":"https://qiita.com/hanachin_/items/cd53f2b5e408b49b61f2","user":{"description":"既婚バイ","facebook_id":"seiei.higa","followees_count":166,"followers_count":120,"github_login_name":"hanachin","id":"hanachin_","items_count":55,"linkedin_id":"","location":"Naha, Okinawa, Japan","name":"Seiei Miyagi","organization":"YassLab","permanent_id":2074,"profile_image_url":"https://qiita-image-store.s3.amazonaws.com/0/2074/profile-images/1511092027","twitter_screen_name":"hanachin_","website_url":""},"page_views_count":null}]