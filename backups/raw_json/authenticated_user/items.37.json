[{"rendered_body":"\u003cp\u003e\u003ca href=\"https://docs.ruby-lang.org/ja/latest/method/Kernel/m/at_exit.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003e\u003ccode\u003eat_exit\u003c/code\u003e\u003c/a\u003eを使うと終了時に処理を実行できる。\u003cbr\u003e\n通知を送る処理を\u003ccode\u003eat_exit\u003c/code\u003eで登録するRakeタスクを定義し成否を通知したいタスクの依存タスクに追加するとべんり。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"ruby\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eRakefile\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"n\"\u003edesc\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"notify the tasks finished successfully or not\"\u003c/span\u003e\n\u003cspan class=\"n\"\u003etask\u003c/span\u003e \u003cspan class=\"ss\"\u003e:notify_tasks_finished\u003c/span\u003e \u003cspan class=\"k\"\u003edo\u003c/span\u003e\n  \u003cspan class=\"nb\"\u003eat_exit\u003c/span\u003e \u003cspan class=\"k\"\u003edo\u003c/span\u003e\n    \u003cspan class=\"n\"\u003etasks\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"no\"\u003eRake\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eapplication\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003etop_level_tasks\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003ejoin\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\", \"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"vg\"\u003e$!\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003enil?\u003c/span\u003e \u003cspan class=\"o\"\u003e||\u003c/span\u003e \u003cspan class=\"vg\"\u003e$!\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003esuccess?\u003c/span\u003e\n      \u003cspan class=\"nb\"\u003eputs\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"success: \u003c/span\u003e\u003cspan class=\"si\"\u003e#{\u003c/span\u003e\u003cspan class=\"n\"\u003etasks\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eelse\u003c/span\u003e\n      \u003cspan class=\"nb\"\u003eputs\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"fail: \u003c/span\u003e\u003cspan class=\"si\"\u003e#{\u003c/span\u003e\u003cspan class=\"n\"\u003etasks\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eend\u003c/span\u003e\n  \u003cspan class=\"k\"\u003eend\u003c/span\u003e\n\u003cspan class=\"k\"\u003eend\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003edesc\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"hey\"\u003c/span\u003e\n\u003cspan class=\"n\"\u003etask\u003c/span\u003e \u003cspan class=\"ss\"\u003ehey: :notify_tasks_finished\u003c/span\u003e \u003cspan class=\"k\"\u003edo\u003c/span\u003e\n  \u003cspan class=\"nb\"\u003eputs\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"hey\"\u003c/span\u003e\n\u003cspan class=\"k\"\u003eend\u003c/span\u003e\n\n\n\u003cspan class=\"n\"\u003edesc\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"yo\"\u003c/span\u003e\n\u003cspan class=\"n\"\u003etask\u003c/span\u003e \u003cspan class=\"ss\"\u003eyo: :notify_tasks_finished\u003c/span\u003e \u003cspan class=\"k\"\u003edo\u003c/span\u003e\n  \u003cspan class=\"n\"\u003eyo\u003c/span\u003e\n\u003cspan class=\"k\"\u003eend\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"console\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"go\"\u003e% rake hey\nhey\nsuccess: hey\n% rake yo\nrake aborted!\nNameError: undefined local variable or method `yo' for main:Object\n\u003c/span\u003e\u003cspan class=\"gp\"\u003e/home/sei/tmp/rake.rb:22:in `block in \u0026lt;top (required)\u0026gt;\u003c/span\u003e\u003cspan class=\"s1\"\u003e'\n\u003c/span\u003e\u003cspan class=\"gp\"\u003eTasks: TOP =\u0026gt;\u003c/span\u003e \u003cspan class=\"s1\"\u003eyo\n\u003c/span\u003e\u003cspan class=\"go\"\u003e(See full trace by running task with --trace)\nfail: yo\n\u003c/span\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n","body":"[`at_exit`](https://docs.ruby-lang.org/ja/latest/method/Kernel/m/at_exit.html)を使うと終了時に処理を実行できる。\n通知を送る処理を`at_exit`で登録するRakeタスクを定義し成否を通知したいタスクの依存タスクに追加するとべんり。\n\n```ruby:Rakefile\ndesc \"notify the tasks finished successfully or not\"\ntask :notify_tasks_finished do\n  at_exit do\n    tasks = Rake.application.top_level_tasks.join(\", \")\n    if $!.nil? || $!\u0026.success?\n      puts \"success: #{tasks}\"\n    else\n      puts \"fail: #{tasks}\"\n    end\n  end\nend\n\ndesc \"hey\"\ntask hey: :notify_tasks_finished do\n  puts \"hey\"\nend\n\n\ndesc \"yo\"\ntask yo: :notify_tasks_finished do\n  yo\nend\n```\n\n```console\n% rake hey\nhey\nsuccess: hey\n% rake yo\nrake aborted!\nNameError: undefined local variable or method `yo' for main:Object\n/home/sei/tmp/rake.rb:22:in `block in \u003ctop (required)\u003e'\nTasks: TOP =\u003e yo\n(See full trace by running task with --trace)\nfail: yo\n```\n","coediting":false,"comments_count":0,"created_at":"2017-07-25T00:32:16+09:00","group":null,"id":"ed9ce3a21190be0ae51e","likes_count":8,"private":false,"reactions_count":0,"tags":[{"name":"Ruby","versions":[]},{"name":"rake","versions":[]}],"title":"Rakeの終了時に実行したtaskの成否の通知を送る方法","updated_at":"2017-07-25T00:32:16+09:00","url":"https://qiita.com/hanachin_/items/ed9ce3a21190be0ae51e","user":{"description":"既婚バイ","facebook_id":"seiei.higa","followees_count":166,"followers_count":120,"github_login_name":"hanachin","id":"hanachin_","items_count":55,"linkedin_id":"","location":"Naha, Okinawa, Japan","name":"Seiei Miyagi","organization":"YassLab","permanent_id":2074,"profile_image_url":"https://qiita-image-store.s3.amazonaws.com/0/2074/profile-images/1511092027","twitter_screen_name":"hanachin_","website_url":""},"page_views_count":null}]