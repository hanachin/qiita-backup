[{"rendered_body":"\u003cp\u003eBackbone.jsとCoffeeScriptをお使いのみなさん、こんにちは。\u003c/p\u003e\n\n\u003cp\u003eイベントのcallbackに登録するメソッドをfat arrowで定義してませんか?\u003cbr\u003e\n\u003ccode\u003eBackbone.Events#on\u003c/code\u003eの3番目の引数\u003ccode\u003econtext\u003c/code\u003eを使いましょう。\u003c/p\u003e\n\n\u003cp\u003eメソッドをfat arrowで定義するとmixin出来ない問題についてもちょこっと触れます。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"例\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E4%BE%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e例\u003c/h2\u003e\n\n\u003cul\u003e\n\u003cli\u003eイベント通知のために、グローバルな\u003ccode\u003ePubSub\u003c/code\u003eが定義されています。\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003eNyaModel#initialize\u003c/code\u003eで、\u003ccode\u003eNyaModel#sayMessage\u003c/code\u003eメソッドを\u003ccode\u003ePubSub\u003c/code\u003eに登録しています。\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003ePubSub\u003c/code\u003eから\u003ccode\u003e(」・ω・)」うー！\u003c/code\u003eイベントを受け取ると、\u003ccode\u003eNyaModel#sayMessage\u003c/code\u003eが呼ばれます。\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003eNyaModel#sayMessage\u003c/code\u003eは、\u003ccode\u003eNyaModel\u003c/code\u003eの\u003ccode\u003emessage\u003c/code\u003e属性をコンソールに出力します。\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"今までの僕のfat-arrowなやりかた\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E4%BB%8A%E3%81%BE%E3%81%A7%E3%81%AE%E5%83%95%E3%81%AEfat-arrow%E3%81%AA%E3%82%84%E3%82%8A%E3%81%8B%E3%81%9F\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e今までの僕のfat arrowなやりかた\u003c/h2\u003e\n\n\u003cp\u003e\u003ccode\u003ePubSub\u003c/code\u003eのcallbackに渡すメソッドの中で\u003ccode\u003eNyaModel\u003c/code\u003eの属性を使いたい。\u003cbr\u003e\nだがしかし\u003ccode\u003ePubSub\u003c/code\u003eのcallback関数中では\u003ccode\u003ethis\u003c/code\u003eが\u003ccode\u003ePubSub\u003c/code\u003eになる。\u003cbr\u003e\n\u003ccode\u003ethis\u003c/code\u003eを\u003ccode\u003eNyaModel\u003c/code\u003eに固定するため、メソッドをfat arrow(\u003ccode\u003e=\u0026gt;\u003c/code\u003e)で定義してた。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"coffeescript\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003enyaru.coffee\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"nb\"\u003ewindow\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003ePubSub\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003e_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003eclone\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eBackbone\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003eEvents\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nx\"\u003eNyaModel\u003c/span\u003e \u003cspan class=\"k\"\u003eextends\u003c/span\u003e \u003cspan class=\"nx\"\u003eBackbone\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003eModel\u003c/span\u003e\n  \u003cspan class=\"na\"\u003edefaults\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"na\"\u003emessage\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e'(／・ω・)／にゃー！'\u003c/span\u003e\n\n  \u003cspan class=\"na\"\u003einitialize\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003ePubSub\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003eon\u003c/span\u003e \u003cspan class=\"s\"\u003e'(」・ω・)」うー！'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"vi\"\u003e@\u003c/span\u003e\u003cspan class=\"na\"\u003esayMessage\u003c/span\u003e\n\n  \u003cspan class=\"c1\"\u003e# thisがNyaModelにbindされるようfat arrowで定義\u003c/span\u003e\n  \u003cspan class=\"na\"\u003esayMessage\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003econsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003elog\u003c/span\u003e \u003cspan class=\"vi\"\u003e@\u003c/span\u003e\u003cspan class=\"na\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'message'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"nx\"\u003ePubSub\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003eon\u003c/span\u003e \u003cspan class=\"s\"\u003e'(」・ω・)」うー！'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003econsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003elog\u003c/span\u003e \u003cspan class=\"s\"\u003e'(」・ω・)」うー！'\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nx\"\u003eNyaModel\u003c/span\u003e\n\u003cspan class=\"nx\"\u003ePubSub\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003etrigger\u003c/span\u003e \u003cspan class=\"s\"\u003e'(」・ω・)」うー！'\u003c/span\u003e\n\u003cspan class=\"nx\"\u003ePubSub\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003etrigger\u003c/span\u003e \u003cspan class=\"s\"\u003e'(」・ω・)」うー！'\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nx\"\u003eNyaModel\u003c/span\u003e \u003cspan class=\"na\"\u003emessage\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e\"Let's＼(・ω・)／にゃー！\"\u003c/span\u003e\n\u003cspan class=\"nx\"\u003ePubSub\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003etrigger\u003c/span\u003e \u003cspan class=\"s\"\u003e'(」・ω・)」うー！'\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e# (」・ω・)」うー！\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e# (／・ω・)／にゃー！\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e# (」・ω・)」うー！\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e# (／・ω・)／にゃー！\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e# (」・ω・)」うー！\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e# (／・ω・)／にゃー！\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e# Let's＼(・ω・)／にゃー！\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"contextを使ったfat-arrowじゃないやりかた\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#context%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%9Ffat-arrow%E3%81%98%E3%82%83%E3%81%AA%E3%81%84%E3%82%84%E3%82%8A%E3%81%8B%E3%81%9F\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003econtextを使ったfat arrowじゃないやりかた\u003c/h2\u003e\n\n\u003cp\u003e\u003ccode\u003eBackbone.Events#on\u003c/code\u003eの第3引数でcontextを与えると、callback関数中の\u003ccode\u003ethis\u003c/code\u003eがcontextになります。\u003cbr\u003e\nこれでfat arrowを使う理由がなくなった。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"coffeescript\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003enyaru.coffee\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"nb\"\u003ewindow\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003ePubSub\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003e_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003eclone\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eBackbone\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003eEvents\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nx\"\u003eNyaModel\u003c/span\u003e \u003cspan class=\"k\"\u003eextends\u003c/span\u003e \u003cspan class=\"nx\"\u003eBackbone\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003eModel\u003c/span\u003e\n  \u003cspan class=\"na\"\u003edefaults\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"na\"\u003emessage\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e'(／・ω・)／にゃー！'\u003c/span\u003e\n\n  \u003cspan class=\"na\"\u003einitialize\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e# contextとして@を渡してあげる\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003ePubSub\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003eon\u003c/span\u003e \u003cspan class=\"s\"\u003e'(」・ω・)」うー！'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"vi\"\u003e@\u003c/span\u003e\u003cspan class=\"na\"\u003esayMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"err\"\u003e@\u003c/span\u003e\n\n  \u003cspan class=\"c1\"\u003e# context渡すとthisがNyaModelになるのでfatじゃなくておｋ\u003c/span\u003e\n  \u003cspan class=\"na\"\u003esayMessage\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003econsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003elog\u003c/span\u003e \u003cspan class=\"vi\"\u003e@\u003c/span\u003e\u003cspan class=\"na\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'message'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"nx\"\u003ePubSub\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003eon\u003c/span\u003e \u003cspan class=\"s\"\u003e'(」・ω・)」うー！'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003econsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003elog\u003c/span\u003e \u003cspan class=\"s\"\u003e'(」・ω・)」うー！'\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nx\"\u003eNyaModel\u003c/span\u003e\n\u003cspan class=\"nx\"\u003ePubSub\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003etrigger\u003c/span\u003e \u003cspan class=\"s\"\u003e'(」・ω・)」うー！'\u003c/span\u003e\n\u003cspan class=\"nx\"\u003ePubSub\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003etrigger\u003c/span\u003e \u003cspan class=\"s\"\u003e'(」・ω・)」うー！'\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nx\"\u003eNyaModel\u003c/span\u003e \u003cspan class=\"na\"\u003emessage\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e\"Let's＼(・ω・)／にゃー！\"\u003c/span\u003e\n\u003cspan class=\"nx\"\u003ePubSub\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003etrigger\u003c/span\u003e \u003cspan class=\"s\"\u003e'(」・ω・)」うー！'\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e# (」・ω・)」うー！\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e# (／・ω・)／にゃー！\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e# (」・ω・)」うー！\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e# (／・ω・)／にゃー！\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e# (」・ω・)」うー！\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e# (／・ω・)／にゃー！\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e# Let's＼(・ω・)／にゃー！\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"fat-arrowのままでもいいじゃないの\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#fat-arrow%E3%81%AE%E3%81%BE%E3%81%BE%E3%81%A7%E3%82%82%E3%81%84%E3%81%84%E3%81%98%E3%82%83%E3%81%AA%E3%81%84%E3%81%AE\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003efat arrowのままでもいいじゃないの?\u003c/h2\u003e\n\n\u003cp\u003e確かに今までの例だとその通りです。\u003c/p\u003e\n\n\u003cp\u003eしかしfat arrowのままだとmixinなどで\u003ccode\u003esayMessage\u003c/code\u003eを入れ替えたいときに問題が生じます。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"fat-arrowはmixinできない\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#fat-arrow%E3%81%AFmixin%E3%81%A7%E3%81%8D%E3%81%AA%E3%81%84\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003efat arrowはmixinできない\u003c/h2\u003e\n\n\u003cp\u003efat arrowなmethodをmixinするとき、同じようにfat arrowを使ってこう書くのは間違いです\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"coffeescript\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"nx\"\u003e_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003eextend\u003c/span\u003e \u003cspan class=\"na\"\u003eNyaModel\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\n  \u003cspan class=\"na\"\u003esayMessage\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003econsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003elog\u003c/span\u003e \u003cspan class=\"s\"\u003e\"(」・ω・)」うー！ \u003c/span\u003e\u003cspan class=\"si\"\u003e#{\u003c/span\u003e\u003cspan class=\"vi\"\u003e@\u003c/span\u003e\u003cspan class=\"na\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'message'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eこれは次のようなJavaScriptに展開されます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"javascript\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003e_this\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"nx\"\u003e_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eextend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eNyaModel\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eprototype\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"na\"\u003esayMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nx\"\u003econsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"(」・ω・)」うー！ \"\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003e_this\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"kd\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'message'\u003c/span\u003e\u003cspan class=\"p\"\u003e)));\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e\u003ccode\u003ethis\u003c/code\u003eがトップレベル、ブラウザだと\u003ccode\u003ewindow\u003c/code\u003eオブジェクトにbindされてしまいます。\u003c/p\u003e\n\n\u003cp\u003eしかしfat arrowをやめると、\u003ccode\u003e(」・ω・)」うー！\u003c/code\u003eイベントで呼び出された際に、\u003ccode\u003ethis\u003c/code\u003eが\u003ccode\u003ePubSub\u003c/code\u003eになってしまうのでエラーが出ます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"coffeescript\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003enyaru.coffee\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"nb\"\u003ewindow\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003ePubSub\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003e_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003eclone\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eBackbone\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003eEvents\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nx\"\u003eNyaModel\u003c/span\u003e \u003cspan class=\"k\"\u003eextends\u003c/span\u003e \u003cspan class=\"nx\"\u003eBackbone\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003eModel\u003c/span\u003e\n  \u003cspan class=\"na\"\u003edefaults\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"na\"\u003emessage\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e'(／・ω・)／にゃー！'\u003c/span\u003e\n\n  \u003cspan class=\"na\"\u003einitialize\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003ePubSub\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003eon\u003c/span\u003e \u003cspan class=\"s\"\u003e'(」・ω・)」うー！'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"vi\"\u003e@\u003c/span\u003e\u003cspan class=\"na\"\u003esayMessage\u003c/span\u003e\n\n  \u003cspan class=\"na\"\u003esayMessage\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003econsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003elog\u003c/span\u003e \u003cspan class=\"vi\"\u003e@\u003c/span\u003e\u003cspan class=\"na\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'message'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"nx\"\u003e_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003eextend\u003c/span\u003e \u003cspan class=\"na\"\u003eNyaModel\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\n  \u003cspan class=\"na\"\u003esayMessage\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003econsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003elog\u003c/span\u003e \u003cspan class=\"s\"\u003e\"(」・ω・)」うー！ \u003c/span\u003e\u003cspan class=\"si\"\u003e#{\u003c/span\u003e\u003cspan class=\"vi\"\u003e@\u003c/span\u003e\u003cspan class=\"na\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'message'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nx\"\u003eNyaModel\u003c/span\u003e\n\u003cspan class=\"nx\"\u003ePubSub\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003etrigger\u003c/span\u003e \u003cspan class=\"s\"\u003e'(」・ω・)」うー！'\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e# thisがPubSubにbindされちゃう＞＜\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e# =\u0026gt; TypeError: Object #\u0026lt;Object\u0026gt; has no method 'get'\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"contextがあればmixinも怖くない\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#context%E3%81%8C%E3%81%82%E3%82%8C%E3%81%B0mixin%E3%82%82%E6%80%96%E3%81%8F%E3%81%AA%E3%81%84\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003econtextがあればmixinも怖くない\u003c/h2\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"coffeescript\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003enyaru.coffee\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"nb\"\u003ewindow\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003ePubSub\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003e_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003eclone\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eBackbone\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003eEvents\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nx\"\u003eNyaModel\u003c/span\u003e \u003cspan class=\"k\"\u003eextends\u003c/span\u003e \u003cspan class=\"nx\"\u003eBackbone\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003eModel\u003c/span\u003e\n  \u003cspan class=\"na\"\u003edefaults\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"na\"\u003emessage\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e'(／・ω・)／にゃー！'\u003c/span\u003e\n\n  \u003cspan class=\"na\"\u003einitialize\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003ePubSub\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003eon\u003c/span\u003e \u003cspan class=\"s\"\u003e'(」・ω・)」うー！'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"vi\"\u003e@\u003c/span\u003e\u003cspan class=\"na\"\u003esayMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"err\"\u003e@\u003c/span\u003e\n\n  \u003cspan class=\"na\"\u003esayMessage\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003econsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003elog\u003c/span\u003e \u003cspan class=\"vi\"\u003e@\u003c/span\u003e\u003cspan class=\"na\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'message'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"nx\"\u003e_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003eextend\u003c/span\u003e \u003cspan class=\"na\"\u003eNyaModel\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\n  \u003cspan class=\"c1\"\u003e# contextのおかげでthisがmodelになってる\u003c/span\u003e\n  \u003cspan class=\"na\"\u003esayMessage\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003econsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003elog\u003c/span\u003e \u003cspan class=\"s\"\u003e\"(」・ω・)」うー！ \u003c/span\u003e\u003cspan class=\"si\"\u003e#{\u003c/span\u003e\u003cspan class=\"vi\"\u003e@\u003c/span\u003e\u003cspan class=\"na\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'message'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nx\"\u003eNyaModel\u003c/span\u003e\n\u003cspan class=\"nx\"\u003ePubSub\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003etrigger\u003c/span\u003e \u003cspan class=\"s\"\u003e'(」・ω・)」うー！'\u003c/span\u003e\n\u003cspan class=\"nx\"\u003ePubSub\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003etrigger\u003c/span\u003e \u003cspan class=\"s\"\u003e'(」・ω・)」うー！'\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nx\"\u003eNyaModel\u003c/span\u003e \u003cspan class=\"na\"\u003emessage\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e\"Let's＼(・ω・)／にゃー！\"\u003c/span\u003e\n\u003cspan class=\"nx\"\u003ePubSub\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003etrigger\u003c/span\u003e \u003cspan class=\"s\"\u003e'(」・ω・)」うー！'\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e# (」・ω・)」うー！ (／・ω・)／にゃー！\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e# (」・ω・)」うー！ (／・ω・)／にゃー！\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e# (」・ω・)」うー！ (／・ω・)／にゃー！\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e# (」・ω・)」うー！ Let's＼(・ω・)／にゃー！\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"まとめ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%BE%E3%81%A8%E3%82%81\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eまとめ\u003c/h2\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ccode\u003eBackbone.events#on\u003c/code\u003eの3番目の引数\u003ccode\u003econtext\u003c/code\u003eを渡すと、callback関数中の\u003ccode\u003ethis\u003c/code\u003eが\u003ccode\u003econtext\u003c/code\u003eにbindされる。\u003c/li\u003e\n\u003cli\u003eイベントのcallbackに渡すメソッド中の\u003ccode\u003ethis\u003c/code\u003eを固定するためにfat arrow(\u003ccode\u003e=\u0026gt;\u003c/code\u003e)を使う必要はありません。\u003ccode\u003econtext\u003c/code\u003eを使いましょう。\u003c/li\u003e\n\u003cli\u003eメソッドをfat arrowで定義すると、mixinできません。\n\n\u003cul\u003e\n\u003cli\u003e正確にはできるけど\u003ccode\u003ethis\u003c/code\u003eをbindしなおす必要があって面倒です。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n","body":"\nBackbone.jsとCoffeeScriptをお使いのみなさん、こんにちは。\n\nイベントのcallbackに登録するメソッドをfat arrowで定義してませんか?\n`Backbone.Events#on`の3番目の引数`context`を使いましょう。\n\nメソッドをfat arrowで定義するとmixin出来ない問題についてもちょこっと触れます。\n\n\n## 例\n- イベント通知のために、グローバルな`PubSub`が定義されています。\n- `NyaModel#initialize`で、`NyaModel#sayMessage`メソッドを`PubSub`に登録しています。\n- `PubSub`から`(」・ω・)」うー！`イベントを受け取ると、`NyaModel#sayMessage`が呼ばれます。\n- `NyaModel#sayMessage`は、`NyaModel`の`message`属性をコンソールに出力します。\n\n\n## 今までの僕のfat arrowなやりかた\n\n`PubSub`のcallbackに渡すメソッドの中で`NyaModel`の属性を使いたい。\nだがしかし`PubSub`のcallback関数中では`this`が`PubSub`になる。\n`this`を`NyaModel`に固定するため、メソッドをfat arrow(`=\u003e`)で定義してた。\n\n\n``` nyaru.coffee\nwindow.PubSub = _.clone(Backbone.Events)\n\nclass NyaModel extends Backbone.Model\n  defaults:\n    message: '(／・ω・)／にゃー！'\n\n  initialize: -\u003e\n    PubSub.on '(」・ω・)」うー！', @sayMessage\n\n  # thisがNyaModelにbindされるようfat arrowで定義\n  sayMessage: =\u003e\n    console.log @get('message')\n\nPubSub.on '(」・ω・)」うー！', -\u003e\n  console.log '(」・ω・)」うー！'\n\nnew NyaModel\nPubSub.trigger '(」・ω・)」うー！'\nPubSub.trigger '(」・ω・)」うー！'\n\nnew NyaModel message: \"Let's＼(・ω・)／にゃー！\"\nPubSub.trigger '(」・ω・)」うー！'\n\n# (」・ω・)」うー！\n# (／・ω・)／にゃー！\n# (」・ω・)」うー！\n# (／・ω・)／にゃー！\n# (」・ω・)」うー！\n# (／・ω・)／にゃー！\n# Let's＼(・ω・)／にゃー！\n```\n\n## contextを使ったfat arrowじゃないやりかた\n`Backbone.Events#on`の第3引数でcontextを与えると、callback関数中の`this`がcontextになります。\nこれでfat arrowを使う理由がなくなった。\n\n``` nyaru.coffee\nwindow.PubSub = _.clone(Backbone.Events)\n\nclass NyaModel extends Backbone.Model\n  defaults:\n    message: '(／・ω・)／にゃー！'\n\n  initialize: -\u003e\n    # contextとして@を渡してあげる\n    PubSub.on '(」・ω・)」うー！', @sayMessage, @\n\n  # context渡すとthisがNyaModelになるのでfatじゃなくておｋ\n  sayMessage: -\u003e\n    console.log @get('message')\n\nPubSub.on '(」・ω・)」うー！', -\u003e\n  console.log '(」・ω・)」うー！'\n\nnew NyaModel\nPubSub.trigger '(」・ω・)」うー！'\nPubSub.trigger '(」・ω・)」うー！'\n\nnew NyaModel message: \"Let's＼(・ω・)／にゃー！\"\nPubSub.trigger '(」・ω・)」うー！'\n\n# (」・ω・)」うー！\n# (／・ω・)／にゃー！\n# (」・ω・)」うー！\n# (／・ω・)／にゃー！\n# (」・ω・)」うー！\n# (／・ω・)／にゃー！\n# Let's＼(・ω・)／にゃー！\n```\n\n## fat arrowのままでもいいじゃないの?\n\n確かに今までの例だとその通りです。\n\nしかしfat arrowのままだとmixinなどで`sayMessage`を入れ替えたいときに問題が生じます。\n\n## fat arrowはmixinできない\nfat arrowなmethodをmixinするとき、同じようにfat arrowを使ってこう書くのは間違いです\n\n``` coffeescript\n_.extend NyaModel::\n  sayMessage: =\u003e\n    console.log \"(」・ω・)」うー！ #{@get('message')}\"\n```\n\nこれは次のようなJavaScriptに展開されます。\n\n```` javascript\nvar _this = this;\n\n_.extend(NyaModel.prototype, {\n  sayMessage: function() {\n    return console.log(\"(」・ω・)」うー！ \" + (_this.get('message')));\n  }\n});\n```\n\n`this`がトップレベル、ブラウザだと`window`オブジェクトにbindされてしまいます。\n\nしかしfat arrowをやめると、`(」・ω・)」うー！`イベントで呼び出された際に、`this`が`PubSub`になってしまうのでエラーが出ます。\n\n``` nyaru.coffee\nwindow.PubSub = _.clone(Backbone.Events)\n\nclass NyaModel extends Backbone.Model\n  defaults:\n    message: '(／・ω・)／にゃー！'\n\n  initialize: -\u003e\n    PubSub.on '(」・ω・)」うー！', @sayMessage\n\n  sayMessage: -\u003e\n    console.log @get('message')\n\n_.extend NyaModel::\n  sayMessage: -\u003e\n    console.log \"(」・ω・)」うー！ #{@get('message')}\"\n\nnew NyaModel\nPubSub.trigger '(」・ω・)」うー！'\n\n# thisがPubSubにbindされちゃう＞＜\n# =\u003e TypeError: Object #\u003cObject\u003e has no method 'get'\n```\n\n## contextがあればmixinも怖くない\n\n``` nyaru.coffee\nwindow.PubSub = _.clone(Backbone.Events)\n\nclass NyaModel extends Backbone.Model\n  defaults:\n    message: '(／・ω・)／にゃー！'\n\n  initialize: -\u003e\n    PubSub.on '(」・ω・)」うー！', @sayMessage, @\n\n  sayMessage: -\u003e\n    console.log @get('message')\n\n_.extend NyaModel::\n  # contextのおかげでthisがmodelになってる\n  sayMessage: -\u003e\n    console.log \"(」・ω・)」うー！ #{@get('message')}\"\n\nnew NyaModel\nPubSub.trigger '(」・ω・)」うー！'\nPubSub.trigger '(」・ω・)」うー！'\n\nnew NyaModel message: \"Let's＼(・ω・)／にゃー！\"\nPubSub.trigger '(」・ω・)」うー！'\n\n# (」・ω・)」うー！ (／・ω・)／にゃー！\n# (」・ω・)」うー！ (／・ω・)／にゃー！\n# (」・ω・)」うー！ (／・ω・)／にゃー！\n# (」・ω・)」うー！ Let's＼(・ω・)／にゃー！\n```\n\n## まとめ\n\n- `Backbone.events#on`の3番目の引数`context`を渡すと、callback関数中の`this`が`context`にbindされる。\n- イベントのcallbackに渡すメソッド中の`this`を固定するためにfat arrow(`=\u003e`)を使う必要はありません。`context`を使いましょう。\n- メソッドをfat arrowで定義すると、mixinできません。\n  - 正確にはできるけど`this`をbindしなおす必要があって面倒です。\n","coediting":false,"comments_count":0,"created_at":"2012-11-08T12:15:12+09:00","group":null,"id":"5a8b773b9f9b6b2372a8","likes_count":19,"private":false,"reactions_count":0,"tags":[{"name":"CoffeeScript","versions":[]},{"name":"Backbone.js","versions":[]}],"title":"contextを使ってfat arrowなメソッドを書きなおそう","updated_at":"2017-08-14T16:16:12+09:00","url":"https://qiita.com/hanachin_/items/5a8b773b9f9b6b2372a8","user":{"description":"既婚バイ","facebook_id":"seiei.higa","followees_count":166,"followers_count":120,"github_login_name":"hanachin","id":"hanachin_","items_count":55,"linkedin_id":"","location":"Naha, Okinawa, Japan","name":"Seiei Miyagi","organization":"YassLab","permanent_id":2074,"profile_image_url":"https://qiita-image-store.s3.amazonaws.com/0/2074/profile-images/1511092027","twitter_screen_name":"hanachin_","website_url":""},"page_views_count":null}]